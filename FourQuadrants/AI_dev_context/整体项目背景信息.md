# 4Quadrants (FourQuadrants) 项目架构与开发手册

## 1. 项目基本信息
- **项目名称**: FourQuadrants (由 4Quadrants 修正，避免代码引用冲突)
- **开发者**: 唐颢宸 (Fulu)
- **目标**: 基于四象限法则的 AI 增强型 Todo List
- **核心技术栈**: SwiftUI, SwiftData, ActivityKit, WidgetKit, Swift ML (VecturaKit), watchOS

---

## 2. 工程架构 (Multi-Target Structure)
项目采用标准的 `.xcodeproj` 格式，包含以下三个核心 Target，通过 **App Groups** 实现数据互通。

| Target 名称 | 平台 | 核心职责 |
| :--- | :--- | :--- |
| **FourQuadrants** | iOS/iPadOS | 主 App 逻辑、向量数据库计算、API 调用、后台保活配置。 |
| **FourQuadrantsWidget** | iOS (Ext) | 灵动岛 (Live Activities) 渲染、主屏幕/锁屏小组件。 |
| **FourQuadrantsWatch** | watchOS | 腕上任务快速查看与状态同步。 |

---

## 3. 数据层设计 (Data & AI)

### 3.1 基础持久化 (SwiftData)
- 使用 **SwiftData** 管理任务模型（TaskModel）。
- 勾选 **CloudKit** 支持，实现 iPhone、iPad、Apple Watch 之间的无感数据同步。

### 3.2 向量数据库 (Swift ML / Local Vector DB)
- **用途**: 实现语义化搜索、任务智能分类与优先级推荐。
- **存储方案**: 向量库文件需存放在 **App Groups** 路径下，确保主 App 写入后，小组件能读取并展示推荐。
- **性能优化**: 复杂的 Embedding 计算仅在主 App 后台运行，小组件仅读取结果。

---

## 4. 关键配置清单 (Capabilities)

### 4.1 App Groups (地下数据通道)
- **Group ID**: `group.com.fulu.FourQuadrants`
- **应用场景**: 让 `FourQuadrantsWidget` 能够访问主 App 存储在 `UserDefaults(suiteName:)` 或共享文件夹下的任务数据。

### 4.2 Background Modes (后台保活)
- **Background Fetch**: 定期唤醒抓取最新 API 数据。
- **Background Processing**: 运行重型的向量数据库索引维护任务。
- **Remote Notifications**: 接收云端推送。

### 4.3 Info.plist 权限
- **灵动岛支持**: 必须添加 `NSSupportsLiveActivities = YES`。

---

## 5. 迁移与开发细节

### 5.1 从 .swiftpm 迁移步骤
1. **代码搬运**: 将源文件拖入新项目，勾选 **Target Membership**。
2. **入口对齐**: 在 `FourQuadrantsApp.swift` 中将 `ContentView()` 替换为原来的 `MainView()`。
3. **依赖重装**: 在 `Package Dependencies` 中重新添加原项目使用的第三方库。

### 5.2 灵动岛 (Live Activities) 开发逻辑
- 使用 `ActivityAttributes` 定义数据结构。
- 通过 `Activity.request(attributes:contentState:)` 在主 App 启动。
- 在 `FourQuadrantsWidget` 中通过 `ActivityConfiguration` 编写 UI。

---

## 6. 长期展望与避坑
- **命名规范**: 遵循 `com.fulu.FourQuadrants` 三段式反向域名。
- **跨端适配**: 使用 `NavigationSplitView` 同时适配 iPhone 的单列和 iPad 的侧边栏。
- **Apple Watch**: 核心逻辑共用，UI 使用专门为手表优化的小组件模式。