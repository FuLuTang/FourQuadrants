 aiè‡ªç”¨æ–‡æ¡£ï¼ŒæŒ‰æ¡ç›®è®°å½•è¡ŒåŠ¨è¿›åº¦ï¼ˆç”šè‡³æ‹†åˆ†å°ä»»åŠ¡ï¼Œä»¥åŠè®°å½•å°ä»»åŠ¡è¿›åº¦ï¼‰

## Microsoft To Do Sync (Planned)
- **Library**: MSAL (Microsoft Authentication Library) for iOS.
- **API**: Microsoft Graph API (`/me/todo/lists`).
- **Scopes**: `Tasks.ReadWrite`, `User.Read`.
- **Pre-requisites**: 
    - Register App in Azure Portal.
    - Obtain Client ID.
    - Configure URL Scheme in Info.plist (`msauth.<BundleID>`).
- **Mapping Strategy**: Use `categories` in MS ToDo to sync the "Urgent" status since MS To Do has no native urgency field.
- **Conflict Handling**: Compare `lastModifiedDateTime` from Graph API with `dateLatestModified` in SwiftData.

---

## é•¿æŒ‰é¢„è§ˆåŠŸèƒ½ (Context Menu Preview) - å¼€å‘æ³¨æ„

### âš ï¸ å…³é”®é—®é¢˜ï¼šæ‰‹åŠ¿å†²çª
- `onTapGesture` ä¼šä¸ `contextMenu` çš„é•¿æŒ‰æ‰‹åŠ¿å†²çª
- **è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ä½¿ç”¨ `contextMenu` çš„è§†å›¾ä¸Šï¼Œå°† `onTapGesture` æ”¾åœ¨ `contextMenu` **ä¹‹å**
- æˆ–è€…ä½¿ç”¨ `simultaneousGesture` / `highPriorityGesture` æ¥å¤„ç†ä¼˜å…ˆçº§

### æœŸæœ›æ•ˆæœï¼ˆå‚è€ƒ iOS åŸç”Ÿ Appï¼‰
- é•¿æŒ‰è§¦å‘ï¼šç±»ä¼¼ç›¸å†Œ App é•¿æŒ‰å›¾ç‰‡ã€é‚®ä»¶ App é•¿æŒ‰é‚®ä»¶
- æ˜¾ç¤ºé¢„è§ˆè§†å›¾ + èœå•æŒ‰é’®ï¼ˆå®Œæˆã€åˆ é™¤ã€ç¼–è¾‘ï¼‰
- æ¾æ‰‹åä¿æŒèœå•ï¼Œç‚¹å‡»èœå•é¡¹æˆ–ç©ºç™½å¤„å…³é—­

### æ­£ç¡®çš„ contextMenu ç”¨æ³•
```swift
.contextMenu {
    Button { } label: { Label("å®Œæˆ", systemImage: "checkmark") }
    Button { } label: { Label("ç¼–è¾‘", systemImage: "pencil") }
    Button(role: .destructive) { } label: { Label("åˆ é™¤", systemImage: "trash") }
} preview: {
    TaskPreviewView(task: task)
}
```

### ä¿®æ”¹é¡ºåº
1. å…ˆåº”ç”¨ `.contextMenu`
2. å†åº”ç”¨ `.onTapGesture`ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰

---

## æ¯æ—¥ä»»åŠ¡æ™ºèƒ½å…³è” (Daily Task Auto-Linking) - æŠ€æœ¯æ–¹æ¡ˆ

### ğŸ“‹ ä½¿ç”¨åœºæ™¯
ç”¨æˆ·åœ¨"ä»Šæ—¥è§†å›¾"åˆ›å»ºæ¯æ—¥è®¡åˆ’ä»»åŠ¡æ—¶ï¼ˆå¦‚ "å†™æ•°å­¦ä½œä¸š"ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨è TaskList ä¸­è¯­ä¹‰ç›¸ä¼¼çš„ä»»åŠ¡ï¼ˆå¦‚ "maths p36-38"ï¼‰ï¼Œä¸€é”®å»ºç«‹å…³è”ã€‚å®Œæˆæ¯æ—¥ä»»åŠ¡æ—¶ï¼Œè‡ªåŠ¨åŒæ­¥å®Œæˆå…³è”çš„ TaskList ä»»åŠ¡ã€‚

### ğŸ¯ æ ¸å¿ƒéœ€æ±‚
- **è‡ªåŠ¨æ¨è**ï¼šåˆ›å»ºæ¯æ—¥ä»»åŠ¡æ—¶ï¼Œåå°è®¡ç®—ä¸ TaskList çš„è¯­ä¹‰ç›¸ä¼¼åº¦
- **ä¸€é”®ç¡®è®¤**ï¼šå¼¹å‡ºæ¨èå¡ç‰‡ï¼Œç”¨æˆ·ç‚¹å‡»ç¡®è®¤å³å¯å…³è”
- **åŒæ­¥å®Œæˆ**ï¼šå®Œæˆæ¯æ—¥ä»»åŠ¡ â†’ è‡ªåŠ¨å®Œæˆå…³è”çš„ TaskList ä»»åŠ¡

### ğŸ› ï¸ æŠ€æœ¯è·¯å¾„ï¼ˆå·²éªŒè¯ï¼‰

#### 1. Embedding - NLEmbedding (ç®€ä½“ä¸­æ–‡æ¨¡å‹)
```swift
import NaturalLanguage

// åˆå§‹åŒ–ä¸­æ–‡å¥å­åµŒå…¥æ¨¡å‹ï¼ˆiOS 13.0+ï¼‰
guard let embedding = NLEmbedding.sentenceEmbedding(for: .simplifiedChinese) else { 
    // ç³»ç»Ÿå¯èƒ½éœ€è¦åå°ä¸‹è½½æ¨¡å‹èµ„æº
    return 
}

// å°†ä»»åŠ¡æè¿°è½¬ä¸ºå‘é‡
if let vector = embedding.vector(for: "å†™æ•°å­¦ä½œä¸š") {
    // vector æ˜¯ [Double]ï¼Œéœ€è½¬ä¸º [Float] å­˜å‚¨
}
```

**æŠ€æœ¯ç‰¹æ€§**ï¼š
- âœ… **ç¦»çº¿è¿è¡Œ**ï¼šå®Œå…¨æœ¬åœ°ï¼Œä¸éœ€è¦ç½‘ç»œ
- âœ… **ä¸­å›½åŒºå¯ç”¨**ï¼šä¸ä¾èµ– Apple Intelligence
- âœ… **æ€§èƒ½ä¿è¯**ï¼šiPhone 12 (A14) å¯æµç•…è¿è¡Œ
- âš ï¸ **é¦–æ¬¡ä½¿ç”¨**ï¼šç³»ç»Ÿä¼šåå°ä¸‹è½½è¯­è¨€æ¨¡å‹ï¼ˆçº¦ 50MBï¼‰

#### 2. å­˜å‚¨ - SwiftData æ‰©å±•

**TaskModel å¢åŠ å‘é‡å­—æ®µ**ï¼š
```swift
@Model
class QuadrantTask {
    // ... ç°æœ‰å­—æ®µ ...
    var embeddingData: Data?  // å­˜å‚¨ [Float] çš„å­—èŠ‚æµ
    
    // å‘é‡è½¬ Data çš„è¾…åŠ©æ–¹æ³•
    func setEmbedding(_ vector: [Float]) {
        embeddingData = Data(bytes: vector, count: vector.count * MemoryLayout<Float>.size)
    }
    
    func getEmbedding() -> [Float]? {
        guard let data = embeddingData else { return nil }
        return data.withUnsafeBytes { Array($0.bindMemory(to: Float.self)) }
    }
}
```

**æ¯æ—¥ä»»åŠ¡æ¨¡å‹ï¼ˆæ–°å»ºï¼‰**ï¼š
```swift
@Model
class DailyPlanItem {
    var id: UUID
    var title: String
    var scheduledTime: Date
    var duration: TimeInterval
    var linkedTaskId: UUID?  // å…³è”çš„ QuadrantTask.id
}
```

#### 3. ç›¸ä¼¼åº¦è®¡ç®— - Accelerate (vDSP)

```swift
import Accelerate

func cosineSimilarity(_ vectorA: [Float], _ vectorB: [Float]) -> Float? {
    guard vectorA.count == vectorB.count, !vectorA.isEmpty else { return nil }
    
    // ä½¿ç”¨ SIMD æŒ‡ä»¤åŠ é€Ÿï¼ˆ1ä¸‡æ¡ < 10msï¼‰
    let dotProduct = vDSP.dot(vectorA, vectorB)
    let magnitudeA = sqrt(vDSP.sumOfSquares(vectorA))
    let magnitudeB = sqrt(vDSP.sumOfSquares(vectorB))
    
    guard magnitudeA > 0 && magnitudeB > 0 else { return 0 }
    return dotProduct / (magnitudeA * magnitudeB)
}
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- é¢„å½’ä¸€åŒ–å‘é‡ï¼ˆå­˜å‚¨æ—¶å°±å½’ä¸€åŒ–ï¼‰ï¼Œç›¸ä¼¼åº¦ = ç‚¹ç§¯ï¼ˆçœæ‰é™¤æ³•ï¼‰
- ä½¿ç”¨ `Task.detached` åœ¨åå°çº¿ç¨‹è®¡ç®—ï¼Œé¿å…é˜»å¡ UI

### âš ï¸ è·¨è¯­è¨€é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆ

**é—®é¢˜**ï¼šNLEmbedding ä¸­è‹±æ–‡æ¨¡å‹åˆ†ç¦»ï¼Œ"å†™æ•°å­¦ä½œä¸š" å’Œ "maths p36-38" æ— æ³•ç›´æ¥è¯­ä¹‰æ¯”è¾ƒ

**è§£å†³æ–¹æ¡ˆï¼ˆæ··åˆç­–ç•¥ï¼‰**ï¼š
1. **ä¸»ç­–ç•¥**ï¼šä½¿ç”¨ç®€ä½“ä¸­æ–‡æ¨¡å‹ï¼ˆå¯¹ä¸­è‹±æ··åˆæœ‰ä¸€å®šå®¹å¿åº¦ï¼‰
2. **è¾…åŠ©ç­–ç•¥**ï¼šæ•°å­—/ç¬¦å·å…³é”®è¯åŒ¹é…ï¼ˆå¦‚ "p36" å¯ç”¨æ­£åˆ™æå–ï¼‰
3. **å…œåº•æ–¹æ¡ˆ**ï¼šå§‹ç»ˆæä¾›æ‰‹åŠ¨é€‰æ‹©å…³è”çš„å…¥å£

**æœªæ¥å¯é€‰**ï¼šå¦‚æœåŸç”Ÿæ•ˆæœä¸å¤Ÿï¼Œå¯è½¬æ¢ `paraphrase-multilingual-MiniLM-L12-v2` (Sentence-Transformers) åˆ° CoreML

### ğŸ“ å®ç°æ­¥éª¤

| é˜¶æ®µ | ä»»åŠ¡ | ä¾èµ– |
|------|------|------|
| **Phase 1** | å®Œæˆ"ä»Šæ—¥è§†å›¾"UIï¼ˆæ—¶é—´è½´ + ä»»åŠ¡å—ï¼‰ | æ—  |
| **Phase 2** | ç»™ QuadrantTask å¢åŠ  `embeddingData` å­—æ®µ | SwiftData Migration |
| **Phase 3** | åå°ç”Ÿæˆæ‰€æœ‰ä»»åŠ¡çš„å‘é‡ï¼ˆæ‡’åŠ è½½/å¢é‡ï¼‰ | NLEmbedding |
| **Phase 4** | åˆ›å»ºæ¯æ—¥ä»»åŠ¡æ—¶ï¼Œè®¡ç®—ç›¸ä¼¼åº¦å¹¶æ¨è Top 3 | vDSP |
| **Phase 5** | å®Œæˆæ¯æ—¥ä»»åŠ¡ â†’ åŒæ­¥å®Œæˆå…³è”ä»»åŠ¡ | ç®€å•é€»è¾‘ |

### ğŸ¨ æ¨èçš„ç”¨æˆ·ä½“éªŒ

```
ç”¨æˆ·è¾“å…¥ "å†™æ•°å­¦ä½œä¸š"
        â†“
ç³»ç»Ÿåå°è®¡ç®—ç›¸ä¼¼åº¦ï¼ˆ< 50msï¼‰
        â†“
å¼¹å‡ºæ¨èå¡ç‰‡ï¼š
  ğŸ”— å…³è”ä»»åŠ¡ï¼Ÿ
  ğŸ“ maths p36-38 (ç›¸ä¼¼åº¦: 87%)
  [ç¡®è®¤] [å–æ¶ˆ] [æ‰‹åŠ¨é€‰æ‹©]
        â†“
ç”¨æˆ·ç‚¹ç¡®è®¤ â†’ å»ºç«‹å…³è”
```

---

### ğŸ“… æ¯æ—¥è§†å›¾ (Daily View) - è¯¦ç»†è®¾è®¡è§„åˆ’

#### 1. æ ¸å¿ƒ UI å…ƒç´ å¤åˆ» (å‚è€ƒ iOS åŸç”Ÿæ—¥å†)
- **é¡¶éƒ¨å¯¼èˆªæ **ï¼š
  - ä¸­é—´æ˜¾ç¤ºå½“å‰æ—¥æœŸ "2026å¹´1æœˆ30æ—¥"
  - å·¦å³ç®­å¤´ `< >` åˆ‡æ¢æ—¥æœŸ (æ»‘åŠ¨åˆ‡æ¢)
  - **ç‚¹å‡»æ—¥æœŸ**ï¼šå¼¹å‡ºæ·¡å…¥æ·¡å‡ºçš„ Mini Calendar (å°æ—¥å†) ä¾›å¿«é€Ÿè·³è½¬
- **æ—¶é—´è½´å¸ƒå±€**ï¼š
  - **å·¦ä¾§æ—¶é—´è½´**ï¼š00:00 - 23:00ï¼Œç°è‰²å°å­—ä½“ï¼Œå³å¯¹é½ï¼Œç•™å‡ºåˆé€‚è¾¹è·
  - **ä¸»ä½“åŒºåŸŸ**ï¼šå¯¹åº”æ—¶é—´åˆ»åº¦çš„æ¨ªçº¿ï¼Œä½œä¸ºä»»åŠ¡å—çš„å®¹å™¨
  - **çº¢çº¿æŒ‡ç¤ºå™¨**ï¼šå½“å‰æ—¶é—´å®çº¿ï¼Œå·¦ç«¯æœ‰çº¢ç‚¹/æ—¶é—´æ ‡ç­¾ï¼Œæ¯åˆ†é’Ÿåˆ·æ–°
- **ä»»åŠ¡å— (Task Block)**ï¼š
  - æ‚¬æµ®åœ¨æ—¶é—´çº¿ä¹‹ä¸Š
  - åœ†è§’çŸ©å½¢ï¼Œæ ¹æ® `startTime` å’Œ `duration` è®¡ç®—é«˜åº¦å’Œ Y è½´ä½ç½®
  - é¢œè‰²åŒºåˆ†ï¼ˆæ”¯æŒè‡ªå®šä¹‰æˆ–ç»§æ‰¿åˆ†ç±»é¢œè‰²ï¼‰
- **äº¤äº’æ§ä»¶**ï¼š
  - **å·¦ä¸‹è§’æ‚¬æµ®æŒ‰é’®**ï¼šğŸ“ "å½“å‰æ—¶é—´/å›åˆ°ä»Šå¤©"ï¼Œç‚¹å‡»è‡ªåŠ¨æ»šåŠ¨åˆ°çº¢çº¿ä½ç½®
  - **å³ä¸‹è§’/åº•éƒ¨**ï¼šâ• æ·»åŠ æ–°ä»»åŠ¡

#### 2. ç”¨æˆ·ç¡®è®¤çš„äº¤äº’ç»†èŠ‚
- **æ—¶é—´ç½‘æ ¼**ï¼š**30åˆ†é’Ÿä¸€æ ¼** (åŠå°æ—¶ç²’åº¦)ã€‚
- **è°ƒæ•´æ—¶é—´**ï¼š
  - **é•¿æŒ‰ä¸»ä½“**ï¼šè¿›å…¥æ‹–æ‹½æ¨¡å¼ï¼Œå¸é™„åˆ°æœ€è¿‘çš„ 30åˆ†é’Ÿç½‘æ ¼ã€‚
  - **æ‹–æ‹½è¾¹ç¼˜**ï¼šè°ƒæ•´æ—¶é•¿ (Duration)ï¼Œç²—ç•¥è°ƒæ•´ã€‚
  - **ç²¾ç¡®è°ƒæ•´**ï¼šéœ€ç‚¹å‡»è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œæˆ–åœ¨åˆ›å»ºæ—¶è¾“å…¥ç²¾ç¡®æ—¶é—´ã€‚
- **è‡ªç”±åº¦**ï¼šå…è®¸éæ•´ç‚¹æ˜¾ç¤º (å¦‚ 14:17)ï¼Œä½†æ‹–æ‹½æ“ä½œä¼šå¸é™„ç½‘æ ¼ã€‚
- **è‡ªåŠ¨æ»šåŠ¨**ï¼šè¿›å…¥é¡µé¢æ—¶ï¼Œè‡ªåŠ¨æ»šåŠ¨åˆ°å½“å‰æ—¶é—´ä½ç½®ã€‚

#### 3. æ•°æ®ä¸é€»è¾‘å†³ç­– (å·²ç¡®è®¤)
- **å­˜å‚¨ç­–ç•¥**ï¼š**åˆ†å¼€å­˜å‚¨**ã€‚`DailyTask` ç‹¬ç«‹äº `QuadrantTask`ã€‚
- **å…³è”é€»è¾‘**ï¼š
  - **åˆ›å»º/ç¼–è¾‘æ—¶**ï¼šä¸»åŠ¨æ˜¾ç¤º "æ¨èå…³è”" åŒºåŸŸ (UIé¢„ç•™ä½ç½®)ã€‚
  - **å®ŒæˆåŒæ­¥**ï¼š
    - å››è±¡é™ Task å®Œæˆ/å–æ¶ˆ â†’ è‡ªåŠ¨æ›´æ–° **å½“å¤©** å’Œ **æ˜¨å¤©** çš„å…³è” DailyTask çŠ¶æ€ã€‚
    - **å†å²ä¿æŠ¤**ï¼šæ›´æ—©æ—¥æœŸçš„ DailyTask çŠ¶æ€ä¸éšå››è±¡é™ä»»åŠ¡æ”¹å˜ï¼Œä¿ç•™å†å²è®°å½•ã€‚
    - **å•å‘è¯¢é—®**ï¼šæœªå…³è”çš„ä»»åŠ¡å®Œæˆæ—¶ï¼Œ**ä¸å¼¹çª—è¯¢é—®**å…³è”ï¼Œä¿æŒå¹²æ‰°æœ€å°åŒ–ã€‚
- **å‘é‡è®¡ç®— (Embedding)**ï¼š
  - **å½“å‰ç­–ç•¥**ï¼šå…ˆåš UI å’Œä¸šåŠ¡é€»è¾‘ï¼Œ**é¢„ç•™æ¥å£**ã€‚
  - **æ€§èƒ½é¢„æœŸ**ï¼šiPhone 12 å¤„ç†ç™¾æ¡æ•°æ®æå¿«ï¼Œé¢„è®¡å¯å®æ—¶è®¡ç®—ã€‚
  - **åˆ†æ‰¹è§£é‡Š**ï¼šè‹¥æ•°æ®é‡è¾¾åƒæ¡ï¼Œä¸€æ¬¡æ€§è®¡ç®—ä¼šå¯¼è‡´ UI å¡é¡¿ (æ‰å¸§)ã€‚åˆ†æ‰¹æ˜¯æŒ‡æ¯å¸§åªç®—ä¸€éƒ¨åˆ†ï¼Œä¿æŒç•Œé¢æµç•…ã€‚ä½†åœ¨æœ¬åº”ç”¨ä½“é‡ä¸‹æš‚ä¸éœ€è¦ã€‚

#### 4. æŠ€æœ¯æ¦‚å¿µè§£é‡Š
- **Timer vs Combine**ï¼š
  - **Timer**ï¼šä¼ ç»Ÿå®šæ—¶å™¨ï¼Œç”šè‡³å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼å¦‚æœç®¡ç†ä¸å½“ã€‚
  - **Combine**ï¼šApple çš„å“åº”å¼æ¡†æ¶ã€‚è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ SwiftUI åŸç”Ÿçš„ `TimelineView` (ç³»ç»Ÿçº§ä¼˜åŒ–) æˆ–ç®€å•çš„ `Timer.publish` æ¥é©±åŠ¨ä¸€åˆ†é’Ÿä¸€æ¬¡çš„çº¢çº¿åˆ·æ–°ã€‚
- **æ»‘åŠ¨å¡é¡¿é—®é¢˜**ï¼š
  - å‡ ç™¾æ¡ä»»åŠ¡æ•°æ®é‡å¾ˆå°ï¼Œä¸ä¼šå¡é¡¿ã€‚
  - å…³é”®åœ¨äº UIæ¸²æŸ“ã€‚å°†ä½¿ç”¨ `LazyVStack` æˆ–è‡ªå®šä¹‰ `Layout`ï¼Œä»…æ¸²æŸ“å±å¹•å¯è§åŒºåŸŸï¼Œä¿è¯ä¸èˆ¬é¡ºæ»‘ã€‚

#### 5. å®ç°æ­¥éª¤å¾®è°ƒ
1. **çº¯ UI è¿˜åŸ**ï¼šå®ç°é«˜åº¦è¿˜åŸ iOS æ—¥å†çš„æ—¶é—´è½´å’Œæ»šåŠ¨äº¤äº’ï¼ˆå…ˆç”¨å‡æ•°æ®ï¼‰ã€‚
2. **æ•°æ®å¯¹æ¥**ï¼šå®ç° `DailyTask` æ¨¡å‹å’Œ SwiftData å­˜å‚¨ã€‚
3. **ä¸šåŠ¡é€»è¾‘**ï¼šå¢åˆ æ”¹æŸ¥ã€æ‹–æ‹½å¸é™„ç®—æ³•ã€‚
4. **å…³è”ç³»ç»Ÿ**ï¼šåç»­æ¥å…¥å‘é‡é€»è¾‘ã€‚


---

## âœ… æœ€æ–°ç¡®å®šçš„è®¾è®¡å†³ç­– (2026-01-30)

### 1. æ•°æ®åŒæ­¥ç­–ç•¥
- **å…¨è‡ªåŠ¨åŒæ­¥**ï¼šæ— éœ€å¼¹çª—ç¡®è®¤
- å››è±¡é™ä»»åŠ¡å®Œæˆ â†’ è‡ªåŠ¨åŒæ­¥åˆ°ä»Šæ—¥å…³è”ä»»åŠ¡
- ä»Šæ—¥ä»»åŠ¡å®Œæˆ â†’ æ ¹æ®ç”¨æˆ·é€‰æ‹©åŒæ­¥åˆ°å››è±¡é™ä»»åŠ¡

### 2. æ•°æ®å…³è”å…³ç³»
- **å¤šå¯¹ä¸€å…³ç³»ç¡®è®¤**ï¼šå¤šä¸ªæ¯æ—¥ä»»åŠ¡å¯ä»¥å…³è”åŒä¸€ä¸ªå››è±¡é™ä»»åŠ¡
  - **å…¸å‹åœºæ™¯**ï¼š"ä¿®æ‰‹è¡¨"ä»»åŠ¡è·¨å¤©æœªå®Œæˆï¼Œç¬¬äºŒå¤©åˆåˆ›å»ºå…³è”ä»»åŠ¡
  - **ç‰¹æ®Šåœºæ™¯**ï¼š"ç©æ¸¸æˆ" åˆ†å¤šå¤©å®Œæˆ part1ã€part2 â†’ **æš‚æœªç¡®å®šå¤„ç†æ–¹æ¡ˆ**
- **æ•°æ®ç»“æ„**ï¼š
  - `DailyTask.linkedQuadrantTaskID: UUID?` (å¤šå¯¹ä¸€)
  - `QuadrantTask.linkedDailyTaskIDs: [UUID]?` (ä¸€å¯¹å¤š)

### 3. å‘é‡æ£€ç´¢æŠ€æœ¯æ–¹æ¡ˆ
- **å­˜å‚¨ä½ç½®**ï¼šç›´æ¥å­˜ SwiftData (SQLite blob)
- **æ£€ç´¢èŒƒå›´**ï¼šä»…æœªå®Œæˆä»»åŠ¡ï¼ˆé¢„è®¡ ~100 æ¡ï¼‰
- **æ€§èƒ½é¢„æœŸ**ï¼šæ— éœ€é¢å¤–ä¼˜åŒ–ï¼ŒåŸç”Ÿæ–¹æ³•å³å¯
- **æŠ€æœ¯é€‰å‹**ï¼šNLEmbedding + Accelerate vDSP
- **ä¸åšå†…å­˜ç¼“å­˜**ï¼šæ•°æ®é‡å°ï¼Œç›´æ¥æŸ¥åº“å³å¯

---

## ğŸ¤” å¾…è®¨è®ºçš„æ ¸å¿ƒé—®é¢˜

### é—®é¢˜ 1ï¼šæ˜¯å¦çœŸçš„éœ€è¦å¤æ‚çš„å…³è”é€»è¾‘ï¼Ÿ

#### æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | æ–¹æ¡ˆ Aï¼šå¤æ‚å…³è”ï¼ˆå½“å‰ï¼‰ | æ–¹æ¡ˆ Bï¼šç®€åŒ–ç‰ˆ | æ–¹æ¡ˆ Cï¼šå»¶åå†³ç­–ï¼ˆæ¨èï¼‰ |
|------|----------------------|-------------|---------------------|
| **æµç¨‹** | åˆ›å»ºæ—¶é¢„è®¾ â†’ å®Œæˆæ—¶åŒæ­¥ | çº¯æ—¶é—´è§„åˆ’ + æ‰‹åŠ¨å®Œæˆ | å®Œæˆæ—¶æ‰å†³ç­– |
| **ä¼˜ç‚¹** | ä½“éªŒæµç•… | é€»è¾‘ç®€å• | å†³ç­–ç‚¹è‡ªç„¶ + æ”¯æŒçµåŠ¨å²› |
| **ç¼ºç‚¹** | é€»è¾‘å¤æ‚ï¼Œè¾¹ç•Œæƒ…å†µå¤š | éœ€è¦åˆ‡æ¢é¡µé¢ | éœ€è¦é¢å¤–å¼¹çª—ï¼ˆä½†ç²¾ç®€ï¼‰ |
| **å®ç°éš¾åº¦** | â­â­â­â­ | â­ | â­â­â­ |

#### æ–¹æ¡ˆ C è¯¦ç»†è®¾è®¡ï¼ˆæ¨èï¼‰

**æ ¸å¿ƒæ€è·¯**ï¼šæŠŠ"å®Œæˆç¨‹åº¦"å†³ç­–å»¶ååˆ°å®Œæˆé‚£ä¸€åˆ»

**äº¤äº’æµç¨‹**ï¼š
1. **åˆ›å»ºæ—¶**ï¼šåªå…³è”ï¼Œä¸é¢„è®¾å®Œæˆç¨‹åº¦ï¼ˆç§»é™¤"åšä¸€åŠ/åšå®Œ"é€‰æ‹©å™¨ï¼‰
2. **å®Œæˆæ—¶**ï¼šç‚¹å‡»ä»»åŠ¡å—ä¸Šçš„ âœ… æŒ‰é’®
3. **å¼¹å‡ºå¿«é€Ÿç¡®è®¤** (Half Sheet)ï¼š
   ```
   å®Œæˆäº†ã€Œå†™ä»£ç ã€
   
   å…³è”çš„å››è±¡é™ä»»åŠ¡ï¼š
   ğŸ”´ å®Œæˆ iOS å¼€å‘æ–‡æ¡£
   
   [âœ… åšå®Œäº†ï¼Œä¸€èµ·æ ‡è®°å®Œæˆ] â† é«˜äº®
   [ğŸ“ åªæ˜¯åšäº†ä¸€éƒ¨åˆ†]
   [å–æ¶ˆ]
   ```
4. **æœªæ¥æ‰©å±•**ï¼šçµåŠ¨å²›é•¿æŒ‰ â†’ åŒæ ·çš„å¿«é€Ÿç¡®è®¤ç•Œé¢

**ä¼˜åŠ¿**ï¼š
- âœ… ç”¨æˆ·ä¸éœ€è¦æå‰é¢„æµ‹èƒ½ä¸èƒ½åšå®Œ
- âœ… å†³ç­–ç‚¹æ›´è‡ªç„¶ï¼ˆå®Œæˆæ—¶æ‰éœ€è¦æ€è€ƒï¼‰
- âœ… é¿å…"åšä¸€åŠ"çŠ¶æ€çš„å¤æ‚ç®¡ç†
- âœ… ä¸ºçµåŠ¨å²›é¢„ç•™æ¥å£
- âœ… é€»è¾‘ç®€å•ï¼šåªåœ¨å®Œæˆæ—¶åˆ¤æ–­ä¸€æ¬¡

**éœ€è¦è§£å†³**ï¼š
- "ç©æ¸¸æˆ part1/part2" åœºæ™¯ï¼šç”¨æˆ·å¯ä»¥å¤šæ¬¡ç‚¹"åšäº†ä¸€éƒ¨åˆ†"ï¼Œæœ€åç‚¹"åšå®Œäº†"

---

### é—®é¢˜ 2ï¼šçµåŠ¨å²›é›†æˆçš„å¤æ‚åº¦

**ç”¨æˆ·æœŸæœ›**ï¼š
- æ˜¾ç¤ºå½“å‰æ—¶é—´æ®µçš„ä»»åŠ¡
- å¿«é€Ÿå®Œæˆï¼ˆç‚¹å‡»/é•¿æŒ‰ï¼‰
- ä¸ç”¨åˆ‡æ¢é¡µé¢

**æŠ€æœ¯å¯è¡Œæ€§**ï¼š
- âœ… Live Activity æ”¯æŒ (iOS 16.1+)
- âœ… å¯ä»¥æ˜¾ç¤ºå½“å‰ä»»åŠ¡
- âœ… å¯ä»¥æ¥æ”¶ç‚¹å‡»äº‹ä»¶
- âš ï¸ éœ€è¦ App Intent + Widget Extension

**å®æ–½å»ºè®®**ï¼š
- **Phase 2**ï¼šå®Œå–„ä»Šæ—¥è§†å›¾åŸºç¡€åŠŸèƒ½
- **Phase 3**ï¼šçµåŠ¨å²›é›†æˆï¼ˆå¦‚æœé‡‡ç”¨æ–¹æ¡ˆ Cï¼Œäº¤äº’è®¾è®¡å·²ç»å…¼å®¹ï¼‰

---

## ğŸ¯ å½“å‰å¼€å‘çŠ¶æ€

### å·²å®Œæˆ âœ…
- **DailyView UI**ï¼š24 å°æ—¶æ—¶é—´è½´ + å½“å‰æ—¶é—´çº¢çº¿
- **DailyTaskFormView**ï¼šåˆ›å»º/ç¼–è¾‘ä»»åŠ¡è¡¨å•
- **æ‹–æ‹½äº¤äº’**ï¼šç§»åŠ¨ä»»åŠ¡ï¼ˆ30åˆ†é’Ÿå¸é™„ï¼‰+ è°ƒæ•´æ—¶é•¿ï¼ˆ15åˆ†é’Ÿå¸é™„ï¼‰
- **æ™ºèƒ½å…³è” UI**ï¼šæ¨è â†’ å…³è” â†’ å–æ¶ˆå…³è” (æ¨¡æ‹Ÿæ•°æ®)
- **å®Œæˆç¨‹åº¦é€‰æ‹©**ï¼šåˆ›å»ºæ—¶é¢„è®¾"åšä¸€åŠ/åšå®Œ"ï¼ˆ**å¯èƒ½ç§»é™¤**ï¼‰

### å¾…å†³ç­– âš ï¸
1. **é‡‡ç”¨å“ªä¸ªæ–¹æ¡ˆ**ï¼šA/B/Cï¼Ÿ
2. **"ç©æ¸¸æˆ part1/part2" åœºæ™¯**ï¼šå¦‚ä½•è®¾è®¡æ•°æ®æ¨¡å‹ï¼Ÿ
3. **å®Œæˆäº¤äº’**ï¼šåœ¨å“ªé‡Œç‚¹å‡»å®Œæˆï¼Ÿï¼ˆä»»åŠ¡å— vs å››è±¡é™é¡µé¢ï¼‰

### ä¸‹ä¸€æ­¥ ğŸ“‹
- **ç­‰å¾…ç”¨æˆ·ç¡®è®¤æ–¹æ¡ˆ**
- æ ¹æ®é€‰å®šæ–¹æ¡ˆè°ƒæ•´ UI/é€»è¾‘
- å®ç°çœŸå®çš„å‘é‡è®¡ç®— + å…³è”æ¨è
- ï¼ˆå¯é€‰ï¼‰çµåŠ¨å²›é›†æˆ

---

## âœ… æœ€ç»ˆæ–¹æ¡ˆç¡®å®šï¼šæ–¹æ¡ˆ E - éšå¼æ™ºèƒ½æ’åº (2026-01-30)

### æ ¸å¿ƒè®¾è®¡ç†å¿µ
- **æ¯æ—¥è§†å›¾**ï¼šçº¯ç²¹çš„æ—¶é—´è§„åˆ’å·¥å…·ï¼Œæ— ä»»ä½•å…³è”æ“ä½œæˆ–çŠ¶æ€æ ‡è®°
- **å››è±¡é™è§†å›¾**ï¼šåœ¨ç°æœ‰æ’åºé€‰é¡¹ä¸­æ–°å¢"æ™ºèƒ½æ’åˆ—"
- **é›¶å¿ƒæ™ºè´Ÿæ‹…**ï¼šä¸å¼•å…¥"boost""æ¨è""å…³è”"ç­‰æ¦‚å¿µï¼Œç”¨æˆ·æ„ŸçŸ¥ï¼šå°±æ˜¯ä¸ªèªæ˜çš„æ’åº

### æ¶æ„è¦ç‚¹ï¼ˆé‡è¦ä¿®æ­£ï¼‰

#### å››è±¡é™ç‹¬ç«‹æ€§
- **4ä¸ªè±¡é™å„è‡ªç‹¬ç«‹**ï¼šæ¯ä¸ªè±¡é™ç®¡ç†è‡ªå·±çš„ä»»åŠ¡åˆ—è¡¨
- **ç½®é¡¶åœ¨è±¡é™å†…**ï¼š`isPinned` æ˜¯è±¡é™å†…éƒ¨çš„æ¦‚å¿µï¼Œä¸è·¨è±¡é™
- **æ’åºåœ¨è±¡é™å†…**ï¼šæ™ºèƒ½æ’åˆ—åªåœ¨**æ¯ä¸ªè±¡é™å†…éƒ¨**èµ·ä½œç”¨

```
å››è±¡é™å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ é‡è¦ & ç´§æ€¥    â”‚ ğŸŸ¡ é‡è¦ & ä¸ç´§æ€¥   â”‚
â”‚  ğŸ“Œ ç½®é¡¶ (2)      â”‚  ğŸ“Œ ç½®é¡¶ (1)       â”‚
â”‚    1. ä»»åŠ¡A â­â­   â”‚    1. ä»»åŠ¡D â­â­â­  â”‚ â† æ™ºèƒ½åˆ†æ•°
â”‚    2. ä»»åŠ¡B â­    â”‚  ğŸ“‹ æ™®é€š            â”‚
â”‚  ğŸ“‹ æ™®é€š (æ™ºèƒ½â†“)  â”‚    1. ä»»åŠ¡E â­â­   â”‚
â”‚    1. ä»»åŠ¡C â­â­â­ â”‚    2. ä»»åŠ¡F â­     â”‚
â”‚    2. ...        â”‚    (æ™ºèƒ½æ’åˆ—)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ ä¸é‡è¦ & ç´§æ€¥  â”‚ âšª ä¸é‡è¦ & ä¸ç´§æ€¥  â”‚
â”‚  (åŒæ ·åˆ†å±‚æ’åº)   â”‚  (åŒæ ·åˆ†å±‚æ’åº)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯å®ç°

#### 1. æ’åºæ¨¡å¼ï¼ˆå…¨å±€è®¾ç½®ï¼‰
```swift
enum TaskSortMode: String, CaseIterable {
    case importance = "æŒ‰é‡è¦æ€§"
    case time = "æŒ‰åˆ›å»ºæ—¶é—´"
    case name = "æŒ‰åç§°"
    case smart = "æ™ºèƒ½æ’åˆ—" // æ–°å¢ï¼Œé»˜è®¤é€‰é¡¹
}

@AppStorage("taskSortMode") var sortMode: TaskSortMode = .smart
```

#### 2. è±¡é™å†…æ’åºé€»è¾‘
```swift
struct QuadrantCell: View {
    let category: TaskCategory
    var tasks: [QuadrantTask] // è¯¥è±¡é™æ‰€æœ‰ä»»åŠ¡
    
    var sortedTasks: [QuadrantTask] {
        let pinned = tasks.filter { $0.isPinned }
        let unpinned = tasks.filter { !$0.isPinned }
        
        // ç½®é¡¶å’Œæ™®é€šåˆ†åˆ«æ’åº
        return sort(pinned) + sort(unpinned)
    }
    
    func sort(_ tasks: [QuadrantTask]) -> [QuadrantTask] {
        switch sortMode {
        case .smart:
            return calculateSmartScore(tasks)
        case .time:
            return tasks.sorted { $0.dateCreated > $1.dateCreated }
        // ...
        }
    }
    
    func calculateSmartScore(_ tasks: [QuadrantTask]) -> [QuadrantTask] {
        guard !recentDailyTasks.isEmpty else {
            // æ— æ¯æ—¥ä»»åŠ¡æ—¶å›é€€åˆ°æŒ‰æ—¶é—´
            return tasks.sorted { $0.dateCreated > $1.dateCreated }
        }
        
        // è®¡ç®—æ¯ä¸ªä»»åŠ¡ä¸æœ€è¿‘3å¤©æ¯æ—¥ä»»åŠ¡çš„æœ€é«˜ç›¸ä¼¼åº¦
        let scored = tasks.map { task in
            (task, maxSimilarity(task, with: recentDailyTasks))
        }
        
        return scored
            .sorted { $0.1 > $1.1 } // ç›¸ä¼¼åº¦é™åº
            .map { $0.0 }
    }
}
```

#### 3. æ€§èƒ½ä¼˜åŒ–
- **ç¼“å­˜æœºåˆ¶**ï¼šè®¡ç®—ç»“æœç¼“å­˜5åˆ†é’Ÿ
- **æ‡’è®¡ç®—**ï¼šåªåœ¨åˆ‡æ¢åˆ°"æ™ºèƒ½æ’åˆ—"æ—¶è®¡ç®—
- **å¼‚æ­¥è®¡ç®—**ï¼šä½¿ç”¨ `Task.detached` é¿å…é˜»å¡ UI
- **é¢„æœŸæ€§èƒ½**ï¼š100ä»»åŠ¡ Ã— 10æ¯æ—¥ä»»åŠ¡ = 1000æ¬¡ç‚¹ç§¯ â†’ ~10ms (vDSP)

### ç”¨æˆ·ä½“éªŒè®¾è®¡

#### è§†è§‰åé¦ˆï¼ˆå¯é€‰ï¼ŒPhase 2ï¼‰
- **æ–¹æ¡ˆ A**ï¼šå®Œå…¨éšè—ï¼ˆæ¨è Phase 1ï¼‰
  - ç”¨æˆ·åªçœ‹åˆ°æ’åºç»“æœ
  - ç®€æ´ã€æ— å¹²æ‰°
  
- **æ–¹æ¡ˆ B**ï¼šå¾®å¦™æç¤ºï¼ˆPhase 2 å¯é€‰ï¼‰
  ```
  å®Œæˆ iOS æ–‡æ¡£ â­â­â­
  â””â†’ ä»Šå¤© 14:00 "å†™ä»£ç " (87%)  â† é•¿æŒ‰æ˜¾ç¤º
  ```

#### é»˜è®¤è¡Œä¸º
- **æ–°å®‰è£…**ï¼šé»˜è®¤"æ™ºèƒ½æ’åˆ—"
- **æ— æ¯æ—¥ä»»åŠ¡**ï¼šè‡ªåŠ¨å›é€€åˆ°"æŒ‰æ—¶é—´"ï¼ŒUI ç°è‰²æç¤º
- **åˆ‡æ¢ç®€å•**ï¼šç‚¹å‡»æ’åºæŒ‰é’® â†’ é€‰æ‹©å…¶ä»–æ¨¡å¼

### ä¼˜åŠ¿æ€»ç»“
1. âœ… **é›¶å¿ƒæ™ºè´Ÿæ‹…**ï¼šä¸å¼•å…¥æ–°æ¦‚å¿µï¼Œå°±æ˜¯æ’åº
2. âœ… **å¼ºè¿«ç—‡å‹å¥½**ï¼šæ¯æ—¥ä»»åŠ¡å®Œå…¨å¹²å‡€ï¼Œæ— çŠ¶æ€æ ‡è®°
3. âœ… **æ¶æ„å…¼å®¹**ï¼šå¤©ç„¶é€‚é…4è±¡é™+ç½®é¡¶çš„ç°æœ‰ç»“æ„
4. âœ… **å®ç°ç®€å•**ï¼šåªéœ€åœ¨ç°æœ‰æ’åºç³»ç»Ÿæ·»åŠ ä¸€ä¸ªé€‰é¡¹
5. âœ… **å¯é€€åŒ–**ï¼šæ— æ¯æ—¥ä»»åŠ¡æ—¶ä¼˜é›…é™çº§
6. âœ… **å¯æ‰©å±•**ï¼šæœªæ¥å¯åŠ "æ˜¾ç¤ºå…³è”åŸå› "ç­‰é«˜çº§åŠŸèƒ½

### ç¼ºç‚¹ä¸é™åˆ¶
- âŒ **ä¸æ”¯æŒçµåŠ¨å²›å¿«é€Ÿå®Œæˆ**ï¼ˆä½†ç”¨æˆ·å¯æ¥å—ï¼‰
- âš ï¸ **éœ€è¦2æ­¥æ“ä½œ**ï¼šå®Œæˆæ¯æ—¥ â†’ åˆ‡åˆ°å››è±¡é™ â†’ å®Œæˆä»»åŠ¡

### å®æ–½è®¡åˆ’

**Phase 1 - ç®€åŒ–æ¯æ—¥è§†å›¾ï¼ˆå½“å‰ï¼‰**
- [x] ç§»é™¤ `DailyTaskFormView` ä¸­çš„"åšä¸€åŠ/åšå®Œ"é€‰æ‹©å™¨
- [x] ç®€åŒ–æ¯æ—¥ä»»åŠ¡ä¸ºçº¯æ—¶é—´è§„åˆ’
- [ ] æäº¤ä»£ç 

**Phase 2 - å®ç°æ™ºèƒ½æ’åº**
- [ ] å®ç°å‘é‡è®¡ç®— (`NLEmbedding` + `vDSP`)
- [ ] åœ¨å››è±¡é™è§†å›¾æ·»åŠ "æ™ºèƒ½æ’åˆ—"é€‰é¡¹
- [ ] å®ç°è±¡é™å†…åˆ†å±‚æ’åºé€»è¾‘
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ï¼‰

**Phase 3 - ä½“éªŒä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰**
- [ ] æ·»åŠ "æ˜¾ç¤ºå…³è”åŸå› "æŠ˜å æç¤º
- [ ] æ’åºç®—æ³•ä¼˜åŒ–ï¼ˆæ—¶é—´è¡°å‡å› å­ï¼‰
- [ ] ç”¨æˆ·æ•™è‚²ï¼ˆé¦–æ¬¡ä½¿ç”¨æç¤ºï¼‰

---

## ğŸŒŸ LiveActivity å®ç°çŠ¶æ€åˆ†æ (2026-02-04)

### ğŸ“‹ é¡¹ç›®æ–‡æ¡£æ¸…å•

| æ–‡æ¡£è·¯å¾„ | ç”¨é€” | çŠ¶æ€ |
|---------|------|------|
| `AI_dev_context/AiRules.md` | AI å¼€å‘è§„åˆ™ä¸æƒé™ | âœ… æ´»è·ƒ |
| `AI_dev_context/AiProjectDetailMemory.md` | AI é•¿æ•ˆè®°å¿†ä¸æŠ€æœ¯ç¬”è®° | âœ… æ´»è·ƒ |
| `AI_dev_context/DevelopHabit.md` | å¼€å‘ä¹ æƒ¯æé†’ | âœ… æ´»è·ƒ |
| `AI_dev_context/UserDevDoc.md` | ç”¨æˆ·éœ€æ±‚ä¸å¾…åŠäº‹é¡¹ | âœ… æ´»è·ƒ |
| `AI_dev_context/æ•´ä½“é¡¹ç›®èƒŒæ™¯ä¿¡æ¯.md` | é¡¹ç›®æ¶æ„ä¸é…ç½®è¯´æ˜ | âœ… æ´»è·ƒ |
| `FourQuadrantsWidget/LiveActivity.ä¼ªä»£ç ` | LiveActivity è®¾è®¡ä¼ªä»£ç  | âœ… è®¾è®¡æ–‡æ¡£ |
| `README.md` | é¡¹ç›®å¯¹å¤–è¯´æ˜ | âœ… å…¬å¼€ |
| `docs/Architecture.md` | æ¶æ„æ–‡æ¡£ | âœ… æŠ€æœ¯å‚è€ƒ |
| `docs/Features.md` | åŠŸèƒ½æ¸…å• | âœ… æŠ€æœ¯å‚è€ƒ |
| `docs/Persistence.md` | æ•°æ®æŒä¹…åŒ–è¯´æ˜ | âœ… æŠ€æœ¯å‚è€ƒ |
| `docs/Testing.md` | æµ‹è¯•æ–‡æ¡£ | âœ… æŠ€æœ¯å‚è€ƒ |

### ğŸ” LiveActivity ä¼ªä»£ç  vs å®é™…å®ç°å¯¹æ¯”

#### âœ… å·²å…·å¤‡çš„åŸºç¡€è®¾æ–½

| é¡¹ç›® | çŠ¶æ€ | å®é™…é…ç½® |
|-----|------|----------|
| **SwiftData Models** | âœ… å·²é…ç½® | `QuadrantTask` + `DailyTask` |
| **DailyTask æ•°æ®å­—æ®µ** | âœ… å®Œæ•´ | `startTime`, `endTime`, `isCompleted`, `title`, `id` å…¨éƒ¨é½å…¨ |
| **App Group** | âœ… å·²é…ç½® | `group.fulu.FourQuadrants` (ä¸‰ç«¯ä¸€è‡´) |
| **Widget Bundle** | âœ… å·²æ³¨å†Œ | `FourQuadrantsWidgetLiveActivity()` å·²åœ¨ bundle ä¸­ |
| **ActivityKit** | âœ… å·²å¯¼å…¥ | Widget ä¸­æœ‰ `import ActivityKit` |

#### âš ï¸ å­—æ®µå‘½åå·®å¼‚ï¼ˆå¯ç›´æ¥æ˜ å°„ï¼‰

| ä¼ªä»£ç å­—æ®µ | å®é™…æ¨¡å‹å­—æ®µ | å¯¹åº”å…³ç³» |
|-----------|-------------|----------|
| `beginTime` | `startTime` | âœ… ä¸€å¯¹ä¸€ |
| `isDone` | `isCompleted` | âœ… ä¸€å¯¹ä¸€ |
| `name` | `title` | âœ… ä¸€å¯¹ä¸€ |
| `date == today` | `scheduledDate` | âœ… éœ€ç”¨ `Calendar.isDateInToday()` |

#### âŒ éœ€è¦å®ç°çš„æ ¸å¿ƒéƒ¨åˆ†

| ä¼ªä»£ç åŠŸèƒ½ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|-----------|---------|-------|
| **ContentState æ•°æ®ç»“æ„** | âŒ Xcode æ¨¡æ¿å ä½ç¬¦ | ğŸ”´ P0 |
| **LiveActivity UI è®¾è®¡** | âŒ æ¨¡æ¿ä»£ç  (Hello emoji) | ğŸ”´ P0 |
| **`checkTask()` é€»è¾‘** | âŒ ä¸» App ä¸­ä¸å­˜åœ¨ | ğŸ”´ P0 |
| **App å¯åŠ¨æ—¶åˆå§‹åŒ–** | âŒ ä»…åˆå§‹åŒ–æ•°æ®åº“ | ğŸ”´ P0 |
| **å®šæ—¶åˆ·æ–°æœºåˆ¶** | âŒ æ—  Timer/BackgroundTasks | ğŸŸ¡ P1 |
| **App å‰åå°ç›‘å¬** | âŒ æ—  `scenePhase` | ğŸŸ¡ P1 |
| **SwiftData å…±äº«è·¯å¾„** | âš ï¸ æœªä½¿ç”¨ App Group | ğŸ”´ P0 |

#### ğŸ”§ å…³é”®ä¿®æ­£ï¼šSwiftData å…±äº«é…ç½®

**å½“å‰é—®é¢˜**ï¼š`FourQuadrantsApp.swift` ä½¿ç”¨é»˜è®¤å­˜å‚¨è·¯å¾„
```swift
// âŒ Widget æ— æ³•è®¿é—®
modelContainer = try ModelContainer(for: QuadrantTask.self, DailyTask.self)
```

**éœ€è¦æ”¹æˆ**ï¼šä½¿ç”¨ App Group å…±äº«è·¯å¾„
```swift
// âœ… Widget å¯è®¿é—®
let config = ModelConfiguration(
    groupContainer: .identifier("group.fulu.FourQuadrants")
)
modelContainer = try ModelContainer(
    for: QuadrantTask.self, DailyTask.self,
    configurations: config
)
```

### ğŸ“ ä¼ªä»£ç è®¾è®¡çš„ ContentState ç»“æ„

æ ¹æ®ä¼ªä»£ç ç¬¬ 42-45 è¡Œï¼Œæ‰€éœ€çš„åŠ¨æ€çŠ¶æ€ï¼š

```swift
struct FourQuadrantsWidgetAttributes: ActivityAttributes {
    public struct ContentState: Codable, Hashable {
        var taskId: String       // UUID.uuidString
        var taskName: String     // åŒ…å« "+N" é‡å æ ‡è¯†
        var startTime: Date      // ç”¨äº ProgressView.Circular
        var endTime: Date        // ç”¨äº staleDate è®¡ç®—
    }
    
    // Attributes å¯ä¸ºç©ºæˆ–åªåŒ…å«å…ƒä¿¡æ¯
    var appName: String = "4Quadrants"
}
```

### ğŸ¯ ä¼ªä»£ç æ ¸å¿ƒé€»è¾‘è¦ç‚¹

1. **æƒé™æ£€æŸ¥** (ç¬¬ 16-19 è¡Œ)ï¼š`ActivityAuthorizationInfo().areActivitiesEnabled`
2. **æŸ¥è¯¢æ¡ä»¶** (ç¬¬ 22-23 è¡Œ)ï¼š`date == today && !isDone && beginTime <= now <= endTime`
3. **æ— ä»»åŠ¡å¤„ç†** (ç¬¬ 26-29 è¡Œ)ï¼š`activeTasks.count == 0` â†’ `end(LiveActivity)`
4. **å¤šä»»åŠ¡é€‰æ‹©** (ç¬¬ 33 è¡Œ)ï¼š`argmin(activeTasks, key = endTime)` é€‰æœ€å…ˆç»“æŸçš„
5. **é‡å æ˜¾ç¤º** (ç¬¬ 38-40 è¡Œ)ï¼š`displayName = selected.name + " +" + overlapCount`
6. **æ›´æ–°åˆ¤æ–­** (ç¬¬ 54-60 è¡Œ)ï¼šåªåœ¨ ID/æ—¶é—´/åç§°å˜åŒ–æ—¶æ‰è°ƒç”¨ `update()`
7. **UI çŠ¶æ€** (ç¬¬ 74-136 è¡Œ)ï¼šExpanded/Compact/Minimal/LockScreen å››ç§å¸ƒå±€

### âœ… ç»“è®º

- **ä¼ªä»£ç è®¾è®¡å®Œæ•´ä¸”åˆç†**ï¼Œä¸ç°æœ‰ `DailyTask` æ¨¡å‹å®Œå…¨å…¼å®¹
- **åŸºç¡€è®¾æ–½å·²å°±ç»ª**ï¼ˆApp Groupã€Widget Bundleã€Modelsï¼‰
- **å®ç°å·¥ä½œé‡**ï¼šä¸­ç­‰ï¼ˆçº¦éœ€ 4-6 å°æ—¶çº¯ç¼–ç ï¼‰
- **ä¸»è¦ä»»åŠ¡**ï¼š
  1. ä¿®æ­£ SwiftData å…±äº«è·¯å¾„
  2. é‡å†™ `ContentState` å’Œ LiveActivity UI
  3. åœ¨ä¸» App å®ç° `checkTask()` + å®šæ—¶å™¨é€»è¾‘
  4. æµ‹è¯•å¤šä»»åŠ¡é‡å åœºæ™¯

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„è§„èŒƒ (2026-02-08)

### æ–‡ä»¶æ”¾ç½®è§„åˆ™

| ç±»å‹ | ç›®å½• | ç¤ºä¾‹ |
|------|------|------|
| `@Model` æ•°æ®æ¨¡å‹ | `Models/` | `QuadrantTask.swift`, `DailyTask.swift` |
| ä¸šåŠ¡é€»è¾‘/ç®¡ç†å™¨ | `Services/` | `TaskManager.swift`, `LiveActivityManager.swift` |
| UI è§†å›¾ | `Views/` | `DailyView.swift`, `SettingsView.swift` |
| å¯å¤ç”¨ç»„ä»¶ | `Views/Components/` | `TaskRow.swift`, `TaskPreviewView.swift` |
| æ ·å¼/è®¾è®¡ç³»ç»Ÿ | `Views/Styles/` | `DesignSystem.swift` |

### âš ï¸ é‡è¦æé†’

1. **ä¸è¦æŠŠæ–‡ä»¶æ”¾åœ¨æ ¹ç›®å½•**ï¼šé™¤äº† `FourQuadrantsApp.swift` å’Œ `MainView.swift`
2. **TaskManager ä¸æ˜¯ View**ï¼šå·²ä» `Views/` ç§»åˆ° `Services/`
3. **æšä¸¾/ç±»å‹å®šä¹‰æ”¾ Models**ï¼šå¦‚ `TaskCategory.swift`

---

## ğŸ”„ App å‡çº§ç®¡ç† (AppLifecycleManager)

### ä½ç½®
`Services/AppLifecycleManager.swift`

### ä½¿ç”¨åœºæ™¯

1. **Schema è¿ç§»**ï¼šå½“ä¿®æ”¹ `@Model` ç»“æ„æ—¶
2. **ç‰ˆæœ¬è¿½è¸ª**ï¼šæ£€æµ‹æ–°å®‰è£…/å‡çº§/åŒç‰ˆæœ¬
3. **é¦–æ¬¡å¯åŠ¨é€»è¾‘**ï¼šåˆå§‹åŒ–é»˜è®¤æ•°æ®ç­‰
4. **What's New**ï¼šç‰ˆæœ¬æ›´æ–°æç¤º

### ä¿®æ”¹ Model åçš„æ“ä½œ

```swift
// 1. é€’å¢ç‰ˆæœ¬å·
static let currentSchemaVersion = 2  // ä» 1 æ”¹ä¸º 2

// 2. æ·»åŠ è¿ç§»å‡½æ•°
private func migrateSchemaToV2(modelContainer: ModelContainer) {
    // è¿ç§»é€»è¾‘
}

// 3. åœ¨ performSchemaMigrationIfNeeded ä¸­è°ƒç”¨
if oldVersion < 2 {
    migrateSchemaToV2(modelContainer: modelContainer)
}
```

### SwiftData è‡ªåŠ¨å¤„ç†çš„å˜æ›´

| å˜æ›´ç±»å‹ | éœ€è¦æ‰‹åŠ¨è¿ç§»? |
|---------|-------------|
| æ·»åŠ å¯é€‰å­—æ®µ | âŒ ä¸éœ€è¦ |
| æ·»åŠ å¸¦é»˜è®¤å€¼çš„å­—æ®µ | âŒ ä¸éœ€è¦ |
| åˆ é™¤å­—æ®µ | âŒ ä¸éœ€è¦ |
| é‡å‘½åå­—æ®µ | âœ… éœ€è¦ |
| æ”¹å˜å­—æ®µç±»å‹ | âœ… éœ€è¦ |

---

---

## æ¯æ—¥è§†å›¾æ‰‹åŠ¿é‡æ„ (Daily View Gesture Refactor) - 2026-02-17

### âš ï¸ å·²è§£å†³çš„å…³é”®é—®é¢˜
1. **æ»‘åŠ¨å†²çª (Scroll Lock)**ï¼šä¹‹å‰ä½¿ç”¨ SwiftUI çš„ `simultaneousGesture` æŒ‚è½½ `DragGesture(minimumDistance: 0)`ï¼Œå¯¼è‡´ `ScrollView` çš„æ‰‹åŠ¿è¢«å®Œå…¨æŠ¢å ï¼Œé¡µé¢æ— æ³•æ»‘åŠ¨ã€‚
2. **é•¿æŒ‰å»¶è¿Ÿ (Static Lift Bug)**ï¼šSwiftUI çš„ `Sequence` æ‰‹åŠ¿åœ¨æ‰‹æŒ‡å®Œå…¨é™æ­¢çš„é•¿æŒ‰è§¦å‘ç¬é—´ï¼Œ`Drag` éƒ¨åˆ†å°šæœªæ¿€æ´»ï¼Œå¯¼è‡´æ— æ³•ç«‹å³è·å–åæ ‡åˆ›å»ºä»»åŠ¡ã€‚

### ğŸ› ï¸ æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼šUIKit ä¸ºæ ¸å¿ƒçš„æ‰‹åŠ¿å±‚
ä¸ºäº†å®ç°â€œä¸èˆ¬é¡ºæ»‘â€ä¸”â€œè§¦å‘å³å¾—â€çš„äº¤äº’ï¼Œå¼•å…¥äº† `TimeGridGesture.swift` (å°è£…äº† UIKit çš„ `UILongPressGestureRecognizer`)ã€‚

**æ¶æ„è®¾è®¡ï¼š**
- **åŒè·¯å¹¶è¡Œ**ï¼šé€šè¿‡ `shouldRecognizeSimultaneouslyWith` è¿”å› `true`ï¼Œå…è®¸ UIKit é•¿æŒ‰ä¸ SwiftUI `ScrollView` çš„æ»‘åŠ¨å¹¶å­˜ã€‚
- **çŠ¶æ€æ¥ç®¡**ï¼š
    - `.began`: ç«‹å³é€šè¿‡ UIKit ä¼ å›çš„ `CGPoint` è°ƒç”¨ `createGhostTask`ï¼ˆå®ç°é•¿æŒ‰å³å‡ºå—ï¼Œæ— éœ€ç§»åŠ¨æ‰‹æŒ‡ï¼‰ã€‚
    - `.changed`: å®æ—¶æ›´æ–° `ghostTask` ä½ç½®ã€‚
    - `.ended`: è°ƒç”¨ `commitGhostTask` æ‰“å¼€ç¼–è¾‘è¡¨å•ã€‚
- **UI è”åŠ¨**ï¼šé•¿æŒ‰è§¦å‘åè®¾ç½® `isGhostDragging = true`ï¼Œè§¦å‘ `.scrollDisabled(true)` é”å®šæ»šåŠ¨ï¼Œç¡®ä¿æ‹–æ‹½ä½“éªŒç¨³å®šã€‚

### ğŸ“Œ å¼€å‘æ³¨æ„äº‹é¡¹
- æ‰‹åŠ¿å±‚å¿…é¡»é€šè¿‡ `.overlay` è¦†ç›–åœ¨ `timeGrid` ä¸Šã€‚
- `Ghost Task` å›¾å±‚å¿…é¡»è®¾ç½® `.allowsHitTesting(false)`ï¼Œå¦åˆ™ä¼šæŒ¡ä½åº•å±‚çš„ UIKit æ‰‹åŠ¿æ¥æ”¶å™¨ã€‚
