# 功能清单 (Feature List)

本篇文档记录了 **FourQuadrants** 已实现的商用级功能及其设计初衷。

## 1. 核心视图与交互 (Core UI/UX)
- [x] **四象限沉浸式布局**：基于 SwiftUI 高级布局实现的九宫格/四象限主界面。
- [x] **拖拽分类 (Drag & Drop)**：支持在象限间自由拖拽任务。系统会自动识别目标象限并智能调整任务的"重要程度"和"紧急状态"。
- [x] **动态层级交互**：在总览视图点击任意象限，可平滑缩放/切入对应的详细分类列表。
- [x] **状态反馈延迟**：任务勾选完成后保持 3 秒可见性，并在 3 秒后优雅消失并重排，提升操作的可撤销性与视觉反馈。

## 2. 智能逻辑算法 (Pro Logic)
- [x] **自动紧急判断**：支持设置"紧急阈值（天）"。系统会自动对比"当前日期"与"目标日期"，当时间差距小于阈值时，任务自动标记为紧急，无需手动干预。
- [x] **双紧急阈值系统 (Dual Urgency Threshold)**：
    *   **原始阈值 (`originalUrgentThresholdDays`)**：保存用户手动设定的紧急阈值，作为不可变的意图记录，始终不被系统修改。
    *   **自动阈值 (`urgentThresholdDays`)**：系统根据拖拽操作动态调整的值。拖入紧急象限时自动设为剩余天数；拖回不紧急象限时根据原始阈值智能恢复或清除。
    *   **智能恢复逻辑**：拖拽回不紧急时，若原始阈值下本就不紧急 → 恢复原始值；若原始阈值下仍紧急 → 强制清除阈值。
    *   **UI 可视化**：任务详情中当两个阈值不同时，同时展示原始阈值和自动阈值，帮助用户理解系统行为。
- [x] **智能排序算法 (Intelligence Sorting)**：
    *   **Level 1**: 置顶任务 (Pinned) 绝对优先。
    *   **Level 2**: 目标日期 (Target Date) 临近者优先。
    *   **Level 3**: 高重要度 (High Importance) 优先。
    *   **Level 4**: 最后修改日期排序。
- [x] **鲁棒的逾期判断**：精确计算任务是否逾期，支持无期限任务的自动过滤，避免逻辑误报。

## 3. 今日视图 (Daily Planner)
- [x] **时间轴日视图**：类似 iOS 日历 App 的日视图，按时间段规划每日任务。
    *   24 小时时间轴（左侧）
    *   任务块按时间段排列，支持自定义颜色
    *   实时移动的"当前时间线"横穿任务块
- [x] **手势交互系统**：
    *   长按拖拽调整任务位置和时间
    *   长按后松手进入编辑模式，可通过上下拖拽区域调整开始时间和时长
    *   空白时间段长按可快速创建新任务
    *   点击空白区域退出编辑模式
- [x] **智能关联 (AI Linking)**：创建每日任务时自动推荐关联四象限任务。
    *   🔍 **语义匹配 (NLEmbedding)**：用户输入"写数学作业"，系统自动识别 TaskList 中的"maths p36-38"
    *   💡 **一键确认**：弹出推荐卡片，点击即可建立关联
    *   ✅ **同步完成**：完成每日任务 → 自动同步完成 TaskList 中的关联任务
- [x] **玻璃效果 (Glass Effect)**：任务块采用毛玻璃材质设计，提升视觉质感。

## 4. 专业工程化特性 (Engineering)
- [x] **数据持久化 (SwiftData)**：采用 Apple 官方的 SwiftData 技术。数据存储在 SQLite 数据库中，相比 JSON 全量读写，具备更高的性能、更灵活的查询能力，并为未来的多端同步奠定了架构基础。
- [x] **Schema 版本迁移**：支持增量 Schema 迁移（当前 V2），新增字段时自动将旧数据前向兼容。
- [x] **国际化 (Localization)**：全 App 文本国际化支持，已适配中文（简体）及英文。
- [x] **语言手动切换**：设置中支持自动跟随系统语言或手动选择中文/英文。
- [x] **单元测试覆盖**：关键排序、逾期、紧急算法、双阈值逻辑均由自动化单元测试（Swift Testing）保护。测试覆盖创建、拖拽、边界值、多次来回等 16 个场景。
- [x] **MVVM 纯度**：ViewModel (TaskManager) 承担了 100% 的业务计算，View 层仅负责响应状态，符合大型项目的开发标准。

## 5. 技术亮点 (Technical Highlights)
- **NLEmbedding (简体中文模型)**：Apple 原生自然语言框架，完全离线运行
- **Accelerate (vDSP)**：利用 SIMD 指令集，1 万条向量比较耗时 < 10ms
- **SwiftData 向量存储**：向量直接存储在 `embeddingData: Data?` 字段，无需额外数据库
- **中国区可用**：不依赖 Apple Intelligence，iPhone 12 (A14) 可流畅运行

---

## 🏗 开发中功能 (Roadmap)

- [ ] Live Activity（实时活动）：锁屏/灵动岛显示当前任务进度
- [ ] 实时关键字搜索与过滤
- [ ] 触感反馈 (Haptic Feedback) 增强
- [ ] 周报统计图表
- [ ] Microsoft To Do 双向同步
